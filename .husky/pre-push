# Run typechecking
pnpm typecheck

# Run vitest in run mode
OUTPUT=$(pnpm vitest run 2>&1)
EXIT_CODE=$?

# If exit code is non-zero but the output contains "No test files found", treat as success
if [ $EXIT_CODE -ne 0 ]; then
  if echo "$OUTPUT" | grep -q "No test files found"; then
    exit 0
  else
    # Real test failure
    echo "$OUTPUT"
    exit $EXIT_CODE
  fi
fi
